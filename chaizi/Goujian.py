import collections
from logzero import logger


JieGou = "ã€¾â¿°â¿±â¿²â¿³â¿´â¿µâ¿¶â¿·â¿¸â¿¹â¿ºâ¿»"
JieGou2 = "â¿°â¿±â¿´â¿µâ¿¶â¿·â¿¸â¿¹â¿ºâ¿»"
JieGou3 = "â¿²â¿³"

stars2 = 'ğ›‚¦ğ ¦®ğ¡‹¬ğ¡°£ğ¢šğ¤£©ğ¨ªğ¬¼‚ğ¬¼„ğ­”¥ğ¯ ‚ğ°€'
star = stars2[0]

path = "ChaiZi/ChaiZi.txt"
doc = open(path).read().splitlines()
doc = [x.split('\t') for x in doc]
ids = {k: v for k, v in doc}


isolate = ''.join(k for k, v in ids.items()
                  if not v or k == v and ord(k)>10000)
logger.info(("isolate", len(isolate), ''.join(isolate)))


def automic(dic0, base):
    for x in base:
        dic0[x] = x
    dic1 = {}
    for k, v in dic0.items():
        u = ''.join(dic0.get(x, x) for x in v)
        dic1[k] = u
    return dic1


def get_hot(dic0, min_freq=500):
    values = ''.join(dic0.values())
    freq = collections.Counter(values)
    hot = [k for k in freq if freq[k] >= min_freq]
    logger.info((len(hot), ''.join(hot)))
    return hot


dic0 = {k: v for k, v in ids.items()}
base = set()


def slim(dic0, base, min_freq=2):
    hot = get_hot(dic0, min_freq)
    # base = set(isolate) | set(hot)
    base1 = base | set(hot)
    dic1 = automic(dic0, base1)
    logger.info(f"{len(base)} -> {len(base1)}")
    return dic1, base1


logger.info(f"epoch:{0}")
dic1, base = slim(dic0, base, 10)

logger.info(f"epoch:{1}")
dic2, base = slim(dic1, base, 5)

values = ''.join(dic2.values())
freq = collections.Counter(values)

giveup = [k for k, v in freq.items() if v <= 4]
giveup.sort()
logger.info((f"giveup {len(giveup)}", ''.join(giveup)))

GouJianFreq = [(k, v) for k, v in freq.items()]
GouJianFreq.sort(key=lambda x: (-x[1], x[0]))
with open("ChaiZi/GouJianFreq.tsv", 'w') as f:
    for k, v in GouJianFreq:
        f.write(f"{k}\t{v}"+'\n')

GouJian = [x[0] for x in GouJianFreq if x[1] >=5 ]
GouJian.sort()
with open("ChaiZi/GouJian.txt", 'w') as f:
    for x in GouJian:
        f.write(x+'\n')

"""
[I 220713 02:05:41 Goujian:22] ('isolate', 764, 'âºâº‚âºƒâº„âº…âº†âº‡âº‰âº‹âºŒâºâºâºâºâº‘âº’âº“âº”âº–âº—âº˜âº™âº›âºœâºâºŸâº âº¡âº¢âº£âº¤âº¥âº¦âº§âº¨âº©âºªâº«âº¬âº­âº®âº¯âº°âº±âº²âº³âº´âºµâº¶âº·âº¹âººâº½âº¾âº¿â»€â»â»‚â»ƒâ»„â»…â»†â»‡â»ˆâ»‰â»Šâ»‹â»Œ
â»â»â»â»â»‘â»’â»“â»”â»•â»–â»—â»˜â»™â»šâ»›â»œâ»â»â»Ÿâ» â»¡â»¢â»£â»¤â»¥â»¦â»§â»¨â»©â»ªâ»«â»¬â»­â»®â»¯â»°â»±â»²â»³â¼€â¼â¼‚â¼ƒâ¼„â¼…â¼†â¼‡â¼ˆâ¼‰â¼Šâ¼‹â¼Œâ¼â¼â¼â¼â¼‘â¼’â¼“â¼”â¼•â¼–â¼—â¼˜â¼™â¼šâ¼›â¼œâ¼â¼â¼Ÿâ¼ â¼¡â¼¢â¼£â¼¤â¼¥â¼¦â¼§â¼¨â¼©â¼ªâ¼«â¼¬â¼­â¼®â¼¯â¼°â¼±â¼²â¼³â¼´ 
â¼µâ¼¶â¼·â¼¸â¼¹â¼ºâ¼»â¼¼â¼½â¼¾â¼¿â½€â½â½‚â½ƒâ½„â½…â½†â½‡â½ˆâ½‰â½Šâ½‹â½Œâ½â½â½â½â½‘â½’â½“â½”â½•â½–â½—â½˜â½™â½šâ½›â½œâ½â½â½Ÿâ½ â½¡â½¢â½£â½¤â½¥â½¦â½§â½¨â½©â½ªâ½«â½¬â½­â½®â½¯â½°â½±â½²â½³â½´â½µâ½¶â½·â½¸â½¹â½ºâ½»â½¼â½½â½¾â½¿â¾€â¾â¾‚â¾ƒâ¾„â¾…â¾†â¾‡â¾ˆâ¾‰â¾Šâ¾‹â¾Œâ¾â¾â¾â¾ 
â¾‘â¾’â¾“â¾”â¾•â¾–â¾—â¾˜â¾™â¾šâ¾›â¾œâ¾â¾â¾Ÿâ¾ â¾¡â¾¢â¾£â¾¤â¾¥â¾¦â¾§â¾¨â¾©â¾ªâ¾«â¾¬â¾­â¾®â¾¯â¾°â¾±â¾²â¾³â¾´â¾µâ¾¶â¾·â¾¸â¾¹â¾ºâ¾»â¾¼â¾½â¾¾â¾¿â¿€â¿â¿‚â¿ƒâ¿„â¿…â¿†â¿‡â¿ˆâ¿‰â¿Šâ¿‹â¿Œâ¿â¿â¿â¿â¿‘â¿’â¿“â¿”â¿•ã€‡ã‡€ã‡ã‡‚ã‡ƒã‡„ã‡…ã‡†ã‡‡ã‡ˆã‡‰ã‡Šã‡‹ã‡Œã‡ã‡ã‡ã‡ã‡‘ã‡’ã‡“ã‡”ã‡• 
ã‡–ã‡—ã‡˜ã‡™ã‡šã‡›ã‡œã‡ã‡ã‡Ÿã‡ ã‡¡ã‡¢ã‡£ããƒã„ã…ã†ã§ã”¾ã ¯ã¸¦ää¸€ä¸ˆä¸ä¸ä¸‘ä¸“ä¸”ä¸–ä¸˜ä¸œä¸£ä¸¥ä¸¨ä¸©ä¸¬ä¸±ä¸¶ä¸·ä¸¹ä¸ºä¸¿ä¹€ä¹ä¹„ä¹…ä¹‹ä¹Œä¹ä¹ä¹ä¹‘ä¹—ä¹™ä¹šä¹›ä¹œä¹ä¹Ÿä¹¡ä¹¦äº…äºŠäº‹äºäº•äºœäºäººäº»ä»¥å…‚å…†å…œå…¥å…«å†‚å††å†‰å†Œå†–å†˜å†«å‡ å‡µå‡¸å‡¹åˆ‚å‹¹ 
åŒšåŒ¸ååŒåååœåå©å‚å¶åˆåŠå‘å£å²å›—å¤‚å¤Šå¤®å¤´å¥³å­å­‘å­’å­“å®€å¯¸å°å°¢å°¸å°ºå±±å·å·å·¥å·¨å·±å·²å·³å·´å·¾å¹²å¹´å¹¿å»´å»¿å¼“å½å½‘å½¡å½³å¿ƒå¿„æˆ‰æˆŠæˆ‘æˆ¼æ‰‹æ‰Œæ‰æ‰¿æ”µæ–—æ—¡æ—¥æ›°æ›±æ›²æ›³æœˆæœ¨æœ©æœªæœ«æœ¬æœ±æœ¿æŸæ¥æ±æŸ¬æ¬ æ­¢æ¯‹æ¯Œæ¯æ¯”æ°æ°‘æ°µæ°¸ 
ç¬ç‚ºç†çˆªçˆ²çˆ¿ç‰‡ç‰™ç‰›ç‰œçŠ¬çŠ­ç“œç“¦ç”˜ç”Ÿç”°ç”±ç”²ç”³ç–‹ç–Œç–’ç™½çš®çš¿ç›®ç¤ºç¤»ç¦¹ç¦ºç±³ç²›çºŸç¼¶ç½’è€‚è€³è‚ƒè‚…è‚‰è‡£è‡ªè‡¼èˆŸè‰®è™è™«è¡¤è¥¾è§è§’è¨€è¨è® è°·è±†è±¸è´èº«è»Šè½¦è¾¶é…‰é‡é‡’é’…é•¿é—¨é˜éš¶éš¹éé©éŸ¦é é¡µé£›é£é¥£é»½é½¿é¾œé¾°é¾´é¾µé¾¶ï¤‚ï¤‡ï¤ˆï¥ï¦ 
ï¦ï¨µï©‚ï©›ï©ï©¦ïª´ï«ğ €€ğ €ˆğ €‰ğ €Œğ €ğ €‘ğ €Ÿğ ğ £ğ ¦ğ §ğ ©ğ °ğ ±ğ ¾ğ ‚€ğ ‚‚ğ ‚†ğ ‚‡ğ ‚‰ğ ‚ğ ‚ğ ‚’ğ ‚£ğ ‚¼ğ ƒ‰ğ ƒŠğ ƒ‹ğ ƒŒğ ƒğ ƒğ ƒ‘ğ ƒ“ğ ƒ›ğ ƒœğ ƒ¢ğ „Œğ „ğ „“ğ „™ğ †¢ğ ‘¹ğ •„ğ ˜§ğ ˜¨ğ ™´ğ š’ğ ¤¬ğ ¥“ğ ¥»ğ ¦ğ ¦‘ğ¡†µğ¡—’ğ¡¦¹ğ¡­”ğ¡¯ğ¡°£ğ¡°´ğ¡³¿ğ¡¸ğ¡¿¨ğ¢€“ğ¢ºğ¢—ğ¢œğ¢§ğ¢±ğ¢‘šğ£…²ğ£³ğ£µğ£’šğ£¥‚ğ£¦¶ğ£«¬ğ¤“°ğ¤•ªğ¤£©ğ¤¦¡ğ¤°ƒğ¤´”ğ¥†ğ¥˜…ï¿½ğ¥«—ğ¥¸¨ğ¦‰­ğ¦£ğ¦£ğ¦¥’ğ¦¥«ğ¦¥ºğ¦«µğ§˜‡ğ§°¨ğ¨ˆğ¨ˆğ¨ˆ‘ğ¨³‡ğ¨¸ğ©‡¦ğ©‡§ğ©‡¨ğ©™±ğ©™¿ğ©°Šğ©°‹ğª“•ğª“ğªš¦ğªš´ğª›‰ğª›™ğªœ€ğ«€ğ«–ğ« £ğ¬º·ğ¬º»ğ¬»†ğ¬¼‚ğ¬¼„ğ¬¼˜ğ­•„ğ­£”ğ­¨˜ğ­ºªğ®Œğ®³ğ® •ğ¯ ‚ğ¯ «ğ¯ ­ï¿½ï¿½ğ¯¢ƒ'')

[I 220713 02:05:41 Goujian:56] epoch:0
[I 220713 02:05:41 Goujian:39] (2262, 

[I 220713 02:05:41 Goujian:52] 0 -> 2262
[I 220713 02:05:41 Goujian:59] epoch:1
[I 220713 02:05:41 Goujian:39] (2365,

[I 220713 02:05:42 Goujian:52] 2262 -> 2365
[I 220713 02:05:42 Goujian:67] ('giveup 475', 'â‘ â‘¡â‘¤â‘¥â‘§â‘©âºâº‚âºƒâº…âº‡âº‰âº‹âºâºâºâºâº‘âº’âº“âº”âº–âº—âº˜âº™âº›âºœâºâºŸâº âº¡âº¢âº£âº¤âº¥âº¦âº§âº¨âº©âºªâº«âº¬âº­âº®âº¯âº°âº±âº²âº³âº´âºµâº¶âº·âº¹âººâº½âº¾âº¿â»€â»â»‚â»ƒâ»„â»…â»†â»‡â»ˆâ»‰â»Šâ»‹â»Œâ»
â»â»â»â»‘â»’â»“â»”â»•â»–â»—â»˜â»™â»šâ»›â»œâ»â»â»Ÿâ» â»¡â»¢â»£â»¤â»¥â»¦â»§â»¨â»©â»ªâ»«â»¬â»­â»®â»¯â»°â»±â»²â»³â¼€â¼â¼‚â¼ƒâ¼„â¼…â¼†â¼‡â¼ˆâ¼‰â¼Šâ¼‹â¼Œâ¼â¼â¼â¼â¼‘â¼’â¼“â¼”â¼•â¼–â¼—â¼˜â¼™â¼šâ¼›â¼œâ¼â¼â¼Ÿâ¼ â¼¡â¼¢â¼£â¼¤â¼¥â¼¦â¼§â¼¨â¼©â¼ªâ¼«â¼¬â¼­â¼®â¼¯â¼°â¼±â¼²â¼³â¼´â¼µ 
â¼¶â¼·â¼¸â¼¹â¼ºâ¼»â¼¼â¼½â¼¾â¼¿â½€â½â½‚â½ƒâ½„â½…â½†â½‡â½ˆâ½‰â½Šâ½‹â½Œâ½â½â½â½â½‘â½’â½“â½”â½•â½–â½—â½˜â½™â½šâ½›â½œâ½â½â½Ÿâ½ â½¡â½¢â½£â½¤â½¥â½¦â½§â½¨â½©â½ªâ½«â½¬â½­â½®â½¯â½°â½±â½²â½³â½´â½µâ½¶â½·â½¸â½¹â½ºâ½»â½¼â½½â½¾â½¿â¾€â¾â¾‚â¾ƒâ¾„â¾…â¾†â¾‡â¾ˆâ¾‰â¾Šâ¾‹â¾Œâ¾â¾â¾â¾â¾‘ 
â¾’â¾“â¾”â¾•â¾–â¾—â¾˜â¾™â¾šâ¾›â¾œâ¾â¾â¾Ÿâ¾ â¾¡â¾¢â¾£â¾¤â¾¥â¾¦â¾§â¾¨â¾©â¾ªâ¾«â¾¬â¾­â¾®â¾¯â¾°â¾±â¾²â¾³â¾´â¾µâ¾¶â¾·â¾¸â¾¹â¾ºâ¾»â¾¼â¾½â¾¾â¾¿â¿€â¿â¿‚â¿ƒâ¿„â¿…â¿†â¿‡â¿ˆâ¿‰â¿Šâ¿‹â¿Œâ¿â¿â¿â¿â¿‘â¿’â¿“â¿”â¿•ã€‡ã€¾ã‚¹ãƒªã‡€ã‡ƒã‡…ã‡†ã‡Šã‡‹ã‡Œã‡ã‡ã‡ã‡ã‡‘ã‡’ã‡”ã‡•ã‡–ã‡—ã‡˜ã‡™ã‡š 
ã‡›ã‡œã‡ã‡ã‡Ÿã‡ ã‡¡ã‡¢ã‡£ãƒã†ã§ää¹ä¹„ä¹¦äºŠå††ååå­’å­“æ›±ï¤‚ï¤‡ï¤ˆï¥ï¦ï¦ï¨µï©‚ï©¦ïª´ï«ğ €€ğ €ˆğ €Œğ €ğ €‘ğ €Ÿğ ¦ğ §ğ ©ğ °ğ ±ğ ¾ğ ‚€ğ ‚‚ğ ‚ğ ‚£ğ ‚¼ğ ƒ‰ğ ƒ›ğ ƒ¢ğ „“ğ „™ğ ‘¹ğ •„ğ ™´ğ ¤¬ğ ¥»ğ ¦ğ ¦®ğ¡†µğ¡‹¬ğ¡—’ğ¡¦¹ğ¡­”ğ¡¯ğ¡°´ğ¡³¿ğ¢€“ğ¢ºğ¢—ğ¢œğ¢§ğ¢±ğ¢šğ£…²ğ£’šğ£¦¶ğ£«¬ğ¤†ğ¤•ªğ¤¦¡ğ¤°ƒğ¥†ğ¥Œğ¥¸¨ğ¦‰­ğ¦¥’ğ¦¥«ï¿½ğ¦«µğ¨ˆğ¨ˆğ¨ˆ‘ğ¨³‡ğ©‡¦ğ©‡§ğ©‡¨ğ©™±ğ©°Šğ©°‹ğª“•ğª“ğªš¦ğªš´ğª›‰ğª›™ğ«–ğ¬º·ğ¬»†ğ¬¼‚ğ¬¼„ğ¬¼˜ğ­”¥ğ­£”ğ­¨˜ğ­ºªğ®³ğ® •ğ¯ ‚ğ¯ «ğ¯ ­ğ¯¡ğ¯¢ƒ'')

"""
